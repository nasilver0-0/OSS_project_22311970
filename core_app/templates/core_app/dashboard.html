{% extends "core_app/base.html" %}
{% load static %}

{% block content %}
  <h2>ëŒ€ì‹œë³´ë“œ</h2>

  <nav class="dashboard-nav" style="margin-bottom: 24px;">
    <a class="menu-link" href="{% url 'add_ingredient' %}">ğŸ¥• ì‹ì¬ë£Œ ì¶”ê°€</a> |
    <a class="menu-link" href="{% url 'record_meal'      %}">ğŸ  ì§‘ë°¥ ê¸°ë¡</a>   |
    <a class="menu-link" href="{% url 'meal_stats'       %}">ğŸ“Š í†µê³„ ë³´ê¸°</a>   |
    <a class="menu-link" href="{% url 'settings'         %}">âš™ï¸ ì•Œë¦¼ ì„¤ì •</a>
  </nav>

  <style>
    .alert-section {
      margin: 24px 0;
    }
    .alert-section ul {
      margin-top: 8px;
      margin-left: 16px;
    }
    .alert-section li {
      margin: 4px 0;
    }
    .alert-section a.delete-link {
      margin-left: 8px;
      font-size: 0.9rem;
      color: #007bff;
    }
    .alert-section a.delete-link:hover {
      text-decoration: underline;
    }
  </style>

  <section class="expiry-alerts" style="margin-bottom: 32px;">
    {% if settings.push_expiry_alert and alert_expired_list %}
      <div class="alert-expired">
        <p class="title-expired">
          ğŸ“Œ <strong>ë§Œë£Œëœ ì‹ì¬ë£Œ</strong> (ì˜¤ëŠ˜ ê¸°ì¤€ {{ today|date:"Y-m-d" }} ì´ì „ ë§Œë£Œ)
        </p>
        {% for ingr in alert_expired_list %}
          <p class="item-expired">
            â€¢ <span class="name-expired">{{ ingr.name }}</span>
              <em>(ë§Œë£Œì¼: {{ ingr.expiration_date|date:"Y-m-d" }})</em>
            <a href="{% url 'delete_ingredient' ingr.id %}">ì‚­ì œ</a>
          </p>
        {% endfor %}
      </div>
    {% endif %}

  {% if settings.push_expiry_alert and alert_today_list %}
    <div class="alert-today">
      <p class="title-today">
        ğŸ“… <strong>ì˜¤ëŠ˜ ë§ˆê° ì‹ì¬ë£Œ</strong> (ì˜¤ëŠ˜: {{ today|date:"Y-m-d" }})
      </p>
      {% for ingr in alert_today_list %}
        <p class="item-today">
          â€¢ <span class="name-today">{{ ingr.name }}</span>
          <em>(ë§Œë£Œì¼: {{ ingr.expiration_date|date:"Y-m-d" }})</em>
          <a href="{% url 'delete_ingredient' ingr.id %}">ì‚­ì œ</a>
        </p>
      {% endfor %}
    </div>
  {% endif %}

    {% if settings.push_expiry_alert and alert_major_list %}
      <div class="alert-major">
        <p class="title-major">
          ğŸ•‘ <strong>{{ settings.alert_day_major }}ì¼ ì „ ì•Œë¦¼</strong>
          (ë§Œë£Œì¼: {{ date_major|date:"Y-m-d" }})
        </p>
        {% for ingr in alert_major_list %}
          <p class="item-major">
            â€¢ <span class="name-major">{{ ingr.name }}</span>
              <em>(ë§Œë£Œ: {{ ingr.expiration_date|date:"Y-m-d" }})</em>
            <a href="{% url 'delete_ingredient' ingr.id %}">ì‚­ì œ</a>
          </p>
        {% endfor %}
      </div>
    {% endif %}

    {% if settings.push_expiry_alert and alert_minor_list %}
      <div class="alert-minor">
        <p class="title-minor">
          â° <strong>{{ settings.alert_day_minor }}ì¼ ì „ ê¸´ê¸‰ ì•Œë¦¼</strong>
          (ë§Œë£Œì¼: {{ date_minor|date:"Y-m-d" }})
        </p>
        {% for ingr in alert_minor_list %}
          <p class="item-minor">
            â€¢ <span class="name-minor">{{ ingr.name }}</span>
              <em>(ë§Œë£Œ: {{ ingr.expiration_date|date:"Y-m-d" }})</em>
            <a href="#"
  		class="text-danger delete-trigger"
   		data-bs-toggle="modal"
   		data-bs-target="#confirmDeleteModal"
   		data-delete-url="{% url 'delete_ingredient' ingr.id %}">
  		ì‚­ì œ
            </a>
          </p>
        {% endfor %}
      </div>
    {% endif %}
  </section>

<section class="ingredient-list">
  {% if grouped_ingredients %}
    {% for category, items in grouped_ingredients.items %}
      <div style="margin-bottom: 24px;">
        <h3 style="border-bottom: 1px solid #ccc; padding-bottom: 4px;">{{ category }}</h3>
        <ul style="list-style: none; padding-left: 0;">
          {% for ingr in items %}
            <li style="margin: 4px 0;">
              ğŸ§Š {{ ingr.name }} â€“ {{ ingr.expiration_date|date:"Y-m-d" }}
              <a href="{% url 'delete_ingredient' ingr.id %}" style="color: red; margin-left: 8px;">ì‚­ì œ</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  {% else %}
    <p>ë“±ë¡ëœ ì‹ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
  </section>
{% endblock %}